---
import { Icon } from "astro-icon/components";
import { navConfig } from "@/config";
import DesktopNav from "./DesktopNav.astro";
import Logo from "./Logo.astro";
import DesktopActions from "./DesktopActions.astro";
import MobileMenu from "./MobileMenu.astro";
---

<header
	class="sticky top-0 z-50 bg-white/95 backdrop-blur-xl border-b border-gray-200/80 dark:bg-gray-900/95 dark:border-gray-700/80 shadow-sm transition-all duration-300 ease-out"
>
	<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
		<div class="flex items-center justify-between h-20">
			<Logo />
			<DesktopNav navConfig={navConfig} />
			<DesktopActions />
			<!-- Mobile Actions -->
			<div class="flex lg:hidden items-center space-x-3">
				<button
					id="theme-toggle-mobile"
					class="group relative p-3 rounded-xl bg-linear-to-r from-gray-100 to-gray-200 hover:from-gray-200 hover:to-gray-300 dark:from-gray-800 dark:to-gray-700 dark:hover:from-gray-700 dark:hover:to-gray-600 transition-all duration-200 hover:shadow-lg hover:scale-105 cursor-pointer"
					aria-label="Toggle theme"
				>
					<Icon
						name="sun"
						class="size-5 text-gray-700 dark:text-gray-300 dark:hidden"
					/>
					<Icon
						name="moon"
						class="size-5 text-yellow-500 hidden dark:block"
					/>
				</button>
				<button
					id="mobile-menu-toggle"
					class="group relative p-3 rounded-xl bg-gray-100 hover:bg-gray-200 dark:bg-gray-800 dark:hover:bg-gray-700 transition-all duration-200 hover:scale-105"
					aria-label="Toggle menu"
				>
					<Icon
						name="menu"
						class="size-6 text-gray-700 dark:text-gray-300 transition-transform duration-200 menu-icon"
					/>
					<Icon
						name="close"
						class="size-6 text-gray-700 dark:text-gray-300 transition-transform duration-200 close-icon hidden"
					/>
				</button>
			</div>
		</div>
	</div>
	<div
		class="absolute bottom-0 left-0 right-0 h-px bg-linear-to-r from-transparent via-gray-300 to-transparent dark:via-gray-600"
	>
	</div>
</header>

<div id="mobile-overlay" class="fixed inset-0 z-40 lg:hidden hidden">
	<div class="absolute inset-0 bg-black/50 backdrop-blur-sm animate-fade-in">
	</div>
</div>

<!-- Mobile Menu -->
<MobileMenu navConfig={navConfig} />

<script>
	function toggleTheme() {
		const isDark = document.documentElement.classList.toggle("dark");
		localStorage.setItem("theme", isDark ? "dark" : "light");
	}
	function openMobileMenu() {
		const mobileMenu = document.getElementById("mobile-menu");
		const mobileOverlay = document.getElementById("mobile-overlay");
		const menuIcon = document.querySelector(".menu-icon");
		const closeIcon = document.querySelector(".close-icon");

		mobileMenu?.classList.remove("-translate-y-full");
		mobileMenu?.classList.add("translate-y-0");
		mobileOverlay?.classList.remove("hidden");
		menuIcon?.classList.add("hidden");
		closeIcon?.classList.remove("hidden");
		document.body.style.overflow = "hidden";
	}

	function closeMobileMenu() {
		const mobileMenu = document.getElementById("mobile-menu");
		const mobileOverlay = document.getElementById("mobile-overlay");
		const menuIcon = document.querySelector(".menu-icon");
		const closeIcon = document.querySelector(".close-icon");

		mobileMenu?.classList.add("-translate-y-full");
		mobileMenu?.classList.remove("translate-y-0");
		mobileOverlay?.classList.add("hidden");
		menuIcon?.classList.remove("hidden");
		closeIcon?.classList.add("hidden");
		document.body.style.overflow = "";
	}

	function attachEventListeners() {
		const themeToggle = document.getElementById("theme-toggle");
		const themeToggleMobile = document.getElementById("theme-toggle-mobile");

		themeToggle?.addEventListener("click", toggleTheme);
		themeToggleMobile?.addEventListener("click", toggleTheme);

		const mobileMenuToggle = document.getElementById("mobile-menu-toggle");
		const mobileOverlay = document.getElementById("mobile-overlay");
		const mobileMenu = document.getElementById("mobile-menu");

		mobileMenuToggle?.addEventListener("click", () => {
			if (mobileMenu?.classList.contains("-translate-y-full")) openMobileMenu();
			else closeMobileMenu();
		});

		mobileOverlay?.addEventListener("click", closeMobileMenu);

		const mobileNavLinks = document.querySelectorAll(".mobile-nav-link");
		mobileNavLinks.forEach(link => link.addEventListener("click", closeMobileMenu));

		const currentPath = window.location.pathname;
		const navLinks = document.querySelectorAll(".nav-link");
		navLinks.forEach((link) => {
			link.classList.remove(
				"bg-gradient-to-tr",
				"from-blue-400/10",
				"to-orange-500/50",
				"shadow-sm"
			);
			if (link.getAttribute("href") === currentPath) {
				link.classList.add(
					"bg-gradient-to-tr",
					"from-blue-400/10",
					"to-orange-500/50",
					"shadow-sm"
				);
			}
		});
	}
	attachEventListeners();
	document.addEventListener("astro:after-swap", attachEventListeners);
</script>
